/**************************************************************
WinFilter version 0.8
http://www.winfilter.20m.com
akundert@hotmail.com

Filter type: Low Pass
Filter model: Butterworth
Filter order: 19
Sampling Frequency: 10 KHz
Cut Frequency: 1.250000 KHz
Coefficents Quantization: 16-bit

Z domain Zeros
z = -1.000000 + j 0.000000
z = -1.000000 + j 0.000000
z = -1.000000 + j 0.000000
z = -1.000000 + j 0.000000
z = -1.000000 + j 0.000000
z = -1.000000 + j 0.000000
z = -1.000000 + j 0.000000
z = -1.000000 + j 0.000000
z = -1.000000 + j 0.000000
z = -1.000000 + j 0.000000
z = -1.000000 + j 0.000000
z = -1.000000 + j 0.000000
z = -1.000000 + j 0.000000
z = -1.000000 + j 0.000000
z = -1.000000 + j 0.000000
z = -1.000000 + j 0.000000
z = -1.000000 + j 0.000000
z = -1.000000 + j 0.000000
z = -1.000000 + j 0.000000

Z domain Poles
z = 0.397194 + j -0.201132
z = 0.397194 + j 0.201132
z = 0.478423 + j -0.152831
z = 0.478423 + j 0.152831
z = 0.458558 + j -0.301255
z = 0.458558 + j 0.301255
z = 0.479960 + j -0.340640
z = 0.479960 + j 0.340640
z = 0.365020 + j -0.068798
z = 0.365020 + j 0.068798
z = 0.508700 + j -0.428591
z = 0.508700 + j 0.428591
z = 0.551011 + j -0.504195
z = 0.551011 + j 0.504195
z = 0.602489 + j -0.584072
z = 0.602489 + j 0.584072
z = 0.474220 + j -0.000000
z = 0.668096 + j -0.665814
z = 0.668096 + j 0.665814
***************************************************************/
#define Ntap 511

#define DCgain 65536

__int16 fir(__int16 NewSample) {
    __int16 FIRCoef[Ntap] = { 
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            1,
            0,
            0,
           -1,
           -1,
           -1,
            0,
            2,
            2,
            1,
            0,
           -2,
           -3,
           -2,
            0,
            4,
            5,
            3,
           -1,
           -5,
           -7,
           -4,
            1,
            7,
           10,
            6,
           -2,
          -10,
          -13,
           -8,
            3,
           14,
           19,
           11,
           -4,
          -20,
          -26,
          -16,
            5,
           27,
           35,
           21,
           -7,
          -37,
          -48,
          -29,
           11,
           51,
           65,
           40,
          -15,
          -70,
          -89,
          -53,
           22,
           96,
          121,
           71,
          -31,
         -132,
         -164,
          -95,
           46,
          182,
          223,
          126,
          -69,
         -254,
         -305,
         -166,
          106,
          357,
          418,
          215,
         -166,
         -509,
         -578,
         -276,
          268,
          741,
          810,
          346,
         -451,
        -1115,
        -1165,
         -422,
          799,
         1783,
         1778,
          494,
        -1584,
        -3276,
        -3210,
         -548,
         4449,
        10360,
        15127,
        16952,
        15127,
        10360,
         4449,
         -548,
        -3210,
        -3276,
        -1584,
          494,
         1778,
         1783,
          799,
         -422,
        -1165,
        -1115,
         -451,
          346,
          810,
          741,
          268,
         -276,
         -578,
         -509,
         -166,
          215,
          418,
          357,
          106,
         -166,
         -305,
         -254,
          -69,
          126,
          223,
          182,
           46,
          -95,
         -164,
         -132,
          -31,
           71,
          121,
           96,
           22,
          -53,
          -89,
          -70,
          -15,
           40,
           65,
           51,
           11,
          -29,
          -48,
          -37,
           -7,
           21,
           35,
           27,
            5,
          -16,
          -26,
          -20,
           -4,
           11,
           19,
           14,
            3,
           -8,
          -13,
          -10,
           -2,
            6,
           10,
            7,
            1,
           -4,
           -7,
           -5,
           -1,
            3,
            5,
            4,
            0,
           -2,
           -3,
           -2,
            0,
            1,
            2,
            2,
            0,
           -1,
           -1,
           -1,
            0,
            0,
            1,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0
    };

    static __int16 x[Ntap]; //input samples
    __int32 y=0;            //output sample
    int n;

    //shift the old samples
    for(n=Ntap-1; n>0; n--)
       x[n] = x[n-1];

    //Calculate the new output
    x[0] = NewSample;
    for(n=0; n<Ntap; n++)
        y += FIRCoef[n] * x[n];
    
    return y / DCgain;
}
